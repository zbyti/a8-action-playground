;------------------------------------------------------------------------------
; Brief Memory Map:
; $0a00 - $0dff  charset
; $0e08 - $0eff  Tools - short PROC/FUNC
; $0f00 - $0fff  Display List
; $1000 - $92ff  main code (33535 bytes ~ 33 KB)
; $9300 - $cfff  later usage
; $d800 - $ffef  later usage
;------------------------------------------------------------------------------

DEFINE
  PHR="[$48$8A$48$98$48]",PLR="[$68$A8$68$AA$68]",
  PHA="[$48]",PLA="[$68]",SEI="[$78]",
  RTI="[$40]",RTS="[$60]",OFFJMP="NMI+21",
  WSYNC="[$8D$0A$D4]",CARTOFF="[$A9$1$8D$08$D5]"

;------------------------------------------------------------------------------
;   STABLE     CODEBASE       APPMHI
SET $495=8 SET $491=$E08 SET $E=$E08
;------------------------------------------------------------------------------

MODULE

INCLUDE "H6:TOOLS.ACT"

;------------------------------------------------------------------------------
;SET $E=$F00
;INCLUDE "H6:DL.ACT"
;------------------------------------------------------------------------------

;------------------------------------------------------------------------------
; Main code
;------------------------------------------------------------------------------
SET $E=$1000

;------------------------------------------------------------------------------
INCLUDE "H6:SYS.ACT"
;------------------------------------------------------------------------------

;------------------------------------------------------------------------------
; Main logic
;------------------------------------------------------------------------------
MODULE

BYTE
  COLPF2=$D018,PORTB=$D301,
  CHBAS=$D409,NMIEN=$D40E,
  RTCLOK=$14

CARD
  DLIST=$D402,NMIVEC=$FFFA,LMS=$E000,
  VDSLST=NMI+6,VBIVEC=NMI+19

PROC SYSTEMOFF=*()
  SEI
  NMIEN=0 PORTB=$FE
  NMIVEC=NMI NMIEN=$40
RTS

;------------------------------------------------------------------------------
;INCLUDE "H6:DLI.ACT"
;INCLUDE "H6:VBLK.ACT"
;------------------------------------------------------------------------------

PROC INIT=*()
  MOVEBLOCK($A00,$E000,$400)
  PAUSE() SYSTEMOFF()
  CHBAS=$A
RTS
;------------------------------------------------------------------------------
; Start procedure
;------------------------------------------------------------------------------
PROC MAIN=*()
  ; CARTOFF ; disable Action! 3.6 cartridge
  INIT()
  DO OD
RTS
